<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="A simple and beautiful notes application"
        />
        <title>Simple Notes</title>
        <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css"
        />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <main>
            <section id="note-form">
                <input
                    type="text"
                    id="note-title"
                    placeholder="Title"
                    aria-label="Note title"
                    maxlength="60"
                    title="Maximum title length is 60 characters"
                />
                <span class="char-count" id="note-title-charcount"></span>
                <textarea
                    id="note-body"
                    placeholder="Take a note..."
                    aria-label="Note content"
                ></textarea>
                <div class="editor-toolbar">
                    <button
                        id="add-task-btn"
                        class="toolbar-btn"
                        title="Add task checkbox"
                    >
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <rect
                                x="3"
                                y="3"
                                width="18"
                                height="18"
                                rx="2"
                                ry="2"
                            ></rect>
                            <path d="M9 12l2 2 4-4"></path>
                        </svg>
                    </button>
                    <button id="bold-btn" class="toolbar-btn" title="Bold">
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"
                            ></path>
                            <path
                                d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"
                            ></path>
                        </svg>
                    </button>
                    <button id="italic-btn" class="toolbar-btn" title="Italic">
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <line x1="19" y1="4" x2="10" y2="4"></line>
                            <line x1="14" y1="20" x2="5" y2="20"></line>
                            <line x1="15" y1="4" x2="9" y2="20"></line>
                        </svg>
                    </button>
                    <button
                        id="code-btn"
                        class="toolbar-btn"
                        title="Inline Code"
                    >
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <polyline points="16 18 22 12 16 6"></polyline>
                            <polyline points="8 6 2 12 8 18"></polyline>
                        </svg>
                    </button>
                    <button id="quote-btn" class="toolbar-btn" title="Quote">
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M 3 21 c 3.33 -3.33 5 -6 5 -8 V 5 c 0 -1.1 -0.9 -2 -2 -2 H 4 c -1.1 0 -2 0.9 -2 2 v 6 c 0 1.1 0.9 2 2 2 h 2.5 c 0 1.33 -0.5 3 -1 4 Z M 17 21 c 3.33 -3.33 5 -6 5 -8 V 5 c 0 -1.1 -0.9 -2 -2 -2 h -2 c -1.1 0 -2 0.9 -2 2 v 6 c 0 1.1 0.9 2 2 2 h 2.5 c 0 1.33 0 2 -1 4 Z"
                            ></path>
                        </svg>
                    </button>
                    <button id="link-btn" class="toolbar-btn" title="Link">
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
                            ></path>
                            <path
                                d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                            ></path>
                        </svg>
                    </button>
                    <button
                        id="heading-btn"
                        class="toolbar-btn"
                        title="Heading"
                    >
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path d="M6 12h12"></path>
                            <path d="M6 4v16"></path>
                            <path d="M18 4v16"></path>
                        </svg>
                    </button>
                    <button
                        id="multicode-btn"
                        class="toolbar-btn"
                        title="Code block"
                    >
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <rect
                                x="3"
                                y="3"
                                width="18"
                                height="18"
                                rx="2"
                                ry="2"
                            ></rect>
                            <line x1="8" y1="8" x2="12" y2="8"></line>
                            <line x1="8" y1="12" x2="16" y2="12"></line>
                            <line x1="8" y1="16" x2="10" y2="16"></line>
                        </svg>
                    </button>
                    <button
                        id="list-btn"
                        class="toolbar-btn"
                        title="Unordered List"
                    >
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <line x1="9" y1="6" x2="20" y2="6"></line>
                            <line x1="9" y1="12" x2="20" y2="12"></line>
                            <line x1="9" y1="18" x2="20" y2="18"></line>
                            <circle cx="5" cy="6" r="2"></circle>
                            <circle cx="5" cy="12" r="2"></circle>
                            <circle cx="5" cy="18" r="2"></circle>
                        </svg>
                    </button>
                </div>
                <div class="form-actions">
                    <div
                        class="color-options"
                        aria-label="Note color options"
                    ></div>
                    <button id="add-note" aria-label="Add note">Done</button>
                </div>
            </section>
            <section id="notes-list" aria-label="Your notes"></section>
        </main>

        <div
            id="edit-modal"
            class="modal"
            role="dialog"
            aria-labelledby="edit-modal-title"
        >
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="edit-modal-title">Edit Note</h3>
                    <button
                        class="close-modal"
                        aria-label="Close modal"
                        title="Close"
                    >
                        &times;
                    </button>
                </div>
                <div class="modal-body">
                    <input
                        type="text"
                        id="edit-title"
                        placeholder="Title"
                        aria-label="Edit note title"
                        maxlength="80"
                        title="Maximum title length is 80 characters"
                    />
                    <span class="char-count" id="edit-title-charcount"></span>
                    <textarea
                        id="edit-body"
                        placeholder="Note content..."
                        aria-label="Edit note content"
                    ></textarea>
                    <div class="editor-toolbar">
                        <button
                            id="edit-bold-btn"
                            class="toolbar-btn"
                            title="Bold"
                        >
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"
                                ></path>
                                <path
                                    d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"
                                ></path>
                            </svg>
                        </button>
                        <button
                            id="edit-italic-btn"
                            class="toolbar-btn"
                            title="Italic"
                        >
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <line x1="19" y1="4" x2="10" y2="4"></line>
                                <line x1="14" y1="20" x2="5" y2="20"></line>
                                <line x1="15" y1="4" x2="9" y2="20"></line>
                            </svg>
                        </button>
                        <button
                            id="edit-code-btn"
                            class="toolbar-btn"
                            title="Inline Code"
                        >
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <polyline points="16 18 22 12 16 6"></polyline>
                                <polyline points="8 6 2 12 8 18"></polyline>
                            </svg>
                        </button>
                        <button
                            id="edit-quote-btn"
                            class="toolbar-btn"
                            title="Quote"
                        >
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M3 21c3.33-3.33 5-6 5-8V5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h2c0 1.33-.67 2.67-2 4"
                                ></path>
                                <path
                                    d="M17 21c3.33-3.33 5-6 5-8V5c0-1.1-.9-2-2-2h-2c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h2c0 1.33-.67 2.67-2 4"
                                ></path>
                            </svg>
                        </button>
                        <button
                            id="edit-link-btn"
                            class="toolbar-btn"
                            title="Link"
                        >
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
                                ></path>
                                <path
                                    d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                                ></path>
                            </svg>
                        </button>
                        <button
                            id="edit-heading-btn"
                            class="toolbar-btn"
                            title="Heading"
                        >
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path d="M6 12h12"></path>
                                <path d="M6 4v16"></path>
                                <path d="M18 4v16"></path>
                            </svg>
                        </button>
                        <button
                            id="edit-multicode-btn"
                            class="toolbar-btn"
                            title="Code block"
                        >
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <rect
                                    x="3"
                                    y="3"
                                    width="18"
                                    height="18"
                                    rx="2"
                                    ry="2"
                                ></rect>
                                <line x1="8" y1="8" x2="12" y2="8"></line>
                                <line x1="8" y1="12" x2="16" y2="12"></line>
                                <line x1="8" y1="16" x2="10" y2="16"></line>
                            </svg>
                        </button>
                        <button
                            id="edit-list-btn"
                            class="toolbar-btn"
                            title="Unordered List"
                        >
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <line x1="9" y1="6" x2="20" y2="6"></line>
                                <line x1="9" y1="12" x2="20" y2="12"></line>
                                <line x1="9" y1="18" x2="20" y2="18"></line>
                                <circle cx="5" cy="6" r="2"></circle>
                                <circle cx="5" cy="12" r="2"></circle>
                                <circle cx="5" cy="18" r="2"></circle>
                            </svg>
                        </button>
                        <button
                            id="add-checkbox-btn"
                            class="toolbar-btn"
                            type="button"
                            onclick="insertTaskTemplate(document.getElementById('edit-body'))"
                            title="Add task checkbox"
                        >
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <rect
                                    x="3"
                                    y="3"
                                    width="18"
                                    height="18"
                                    rx="2"
                                    ry="2"
                                ></rect>
                                <path d="M9 12l2 2 4-4"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="form-actions">
                        <div
                            class="color-options edit-color-options"
                            aria-label="Note color options"
                        ></div>
                        <button id="save-edit" aria-label="Save changes">
                            Save
                        </button>
                    </div>
                    <input type="hidden" id="edit-note-id" />
                </div>
            </div>
        </div>

        <div
            id="delete-modal"
            class="modal"
            role="dialog"
            aria-labelledby="delete-modal-title"
        >
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="delete-modal-title">Delete Note</h3>
                    <button
                        class="close-modal"
                        aria-label="Close modal"
                        title="Close"
                    >
                        &times;
                    </button>
                </div>
                <div class="modal-body">
                    <p>
                        Are you sure you want to delete this note? This action
                        cannot be undone.
                    </p>
                    <div class="modal-actions">
                        <button
                            class="cancel-delete"
                            aria-label="Cancel deletion"
                        >
                            Cancel
                        </button>
                        <button
                            class="confirm-delete"
                            aria-label="Confirm deletion"
                        >
                            Delete
                        </button>
                    </div>
                    <input type="hidden" id="delete-note-id" />
                </div>
            </div>
        </div>

        <div id="modal-backdrop" aria-hidden="true"></div>

        <script>
            window.marked = window.marked || {
                parse: function (text) {
                    return text;
                },
                setOptions: function () {},
            };

            try {
                marked.setOptions({
                    breaks: true,
                    gfm: true,
                    headerIds: false,
                    highlight: function (code, lang) {
                        if (
                            typeof Prism !== "undefined" &&
                            Prism.languages[lang]
                        ) {
                            return Prism.highlight(
                                code,
                                Prism.languages[lang],
                                lang
                            );
                        }
                        return code;
                    },
                });
                console.log("Markdown parser initialized");
            } catch (err) {
                console.warn("Error initializing Markdown parser:", err);
            }
        </script>

        <script src="masonry.js"></script>
        <script src="script.js"></script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                console.log("Document ready, waiting for fonts to load...");

                if (!window.noteMasonry) {
                    console.log("noteMasonry not initialized yet, waiting...");
                }

                document.fonts.ready.then(() => {
                    console.log("Fonts loaded");

                    setTimeout(() => {
                        if (window.noteMasonry) {
                            console.log("Refreshing masonry layout");
                            window.noteMasonry.refresh();
                        } else {
                            console.warn("noteMasonry still not available");
                            if (typeof NoteMasonry === "function") {
                                console.log("Creating noteMasonry instance");
                                const computedStyle = getComputedStyle(
                                    document.documentElement
                                );
                                const spacingMd =
                                    parseFloat(
                                        computedStyle.getPropertyValue(
                                            "--spacing-md"
                                        ) || "1rem"
                                    ) * 16;

                                window.noteMasonry = new NoteMasonry(
                                    "#notes-list",
                                    {
                                        minColumnWidth:
                                            window.innerWidth < 640 ? 160 : 220,
                                        maxColumns: 5,
                                        gutter: spacingMd,
                                        animated: true,
                                    }
                                );
                            }
                        }
                    }, 300);
                });
            });

            window.addEventListener("load", function () {
                console.log("Window loaded, refreshing layout");
                setTimeout(() => {
                    if (window.noteMasonry) {
                        window.noteMasonry.refresh();
                    } else if (typeof NoteMasonry === "function") {
                        const computedStyle = getComputedStyle(
                            document.documentElement
                        );
                        const spacingMd =
                            parseFloat(
                                computedStyle.getPropertyValue(
                                    "--spacing-md"
                                ) || "1rem"
                            ) * 16;

                        window.noteMasonry = new NoteMasonry("#notes-list", {
                            minColumnWidth: window.innerWidth < 640 ? 160 : 220,
                            maxColumns: 5,
                            gutter: spacingMd,
                            animated: true,
                        });
                    }
                }, 200);
            });
        </script>
    </body>
</html>
